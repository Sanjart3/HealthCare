<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Welcome Dr <?php echo $userRow['doctorFirstName'];?> <?php echo $userRow['doctorLastName'];?></title>
    <!-- Bootstrap Core CSS -->
    <!-- <link href="assets/css/bootstrap.css" rel="stylesheet"> -->
    <link href="assets/css/material.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="assets/css/sb-admin.css" rel="stylesheet">
    <link href="assets/css/time/bootstrap-clockpicker.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet">
    <!-- Special version of Bootstrap that only affects content wrapped in .bootstrap-iso -->
    <link rel="stylesheet" href="https://formden.com/static/cdn/bootstrap-iso.css" />

    <!--Font Awesome (added because you use icons in your prepend/append)-->
    <link rel="stylesheet" href="https://formden.com/static/cdn/font-awesome/4.4.0/css/font-awesome.min.css" />

    <!-- Inline CSS based on choices in "Settings" tab -->
    <style>
    .bootstrap-iso .formden_header h2,
    .bootstrap-iso .formden_header p,
    .bootstrap-iso form {
        font-family: Arial, Helvetica, sans-serif;
        color: black
    }

    .bootstrap-iso form button,
    .bootstrap-iso form button:hover {
        color: white !important;
    }

    .asteriskField {
        color: red;
    }
    </style>

    <!-- Custom Fonts -->
</head>

<body>
    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="doctordashboard.html">Welcome <span id="fullName"></span></a>
            </div>
            <!-- Top Menu Items -->
            <ul class="nav navbar-right top-nav">


                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i>
                        <span id="fullName2"></span><b
                            class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="doctorprofile.html"><i class="fa fa-fw fa-user"></i> Profile</a>
                        </li>

                        <li class="divider"></li>
                        <li>
                            <a href="../index.html"><i class="fa fa-fw fa-power-off"></i> Log Out</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">
                    <li>
                        <a href="doctordashboard.html"><i class="fa fa-fw fa-dashboard"></i> Dashboard</a>
                    </li>
                    <li class="active">
                        <a href="addschedule.html"><i class="fa fa-fw fa-table"></i> Doctor Schedule</a>
                    </li>
                    <li>
                        <a href="patientlist.html"><i class="fa fa-fw fa-edit"></i> Patient List</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </nav>
        <!-- navigation end -->

        <div id="page-wrapper">
            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <h2 class="page-header">
                            Doctor Schedule
                        </h2>
                        <ol class="breadcrumb">
                            <li class="active">
                                <i class="fa fa-calendar"></i> Schedule
                            </li>
                        </ol>
                    </div>
                </div>
                <!-- Page Heading end-->

                <!-- panel start -->
                <div class="panel panel-primary">

                    <!-- panel heading starat -->
                    <div class="panel-heading">
                        <h3 class="panel-title">Add Schedule</h3>
                    </div>
                    <!-- panel heading end -->

                    <div class="panel-body">
                        <!-- panel content start -->
                        <div class="bootstrap-iso">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <form class="form-horizontal" id="schedule-form">
                                            <div class="form-group form-group-lg">
                                                <label class="control-label col-sm-2 requiredField" for="date">
                                                    Date
                                                    <span class="asteriskField">*</span>
                                                </label>
                                                <div class="col-sm-10">
                                                    <div class="input-group">
                                                        <div class="input-group-addon">
                                                            <i class="fa fa-calendar"></i>
                                                        </div>
                                                        <input class="form-control" id="date" name="date" type="text" required />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group form-group-lg">
                                                <label class="control-label col-sm-2 requiredField" for="starttime">
                                                    Start Time
                                                    <span class="asteriskField">*</span>
                                                </label>
                                                <div class="col-sm-10">
                                                    <div class="input-group clockpicker" data-align="top" data-autoclose="true">
                                                        <div class="input-group-addon">
                                                            <i class="fa fa-clock-o"></i>
                                                        </div>
                                                        <input class="form-control" id="starttime" name="starttime" type="text" required />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group form-group-lg">
                                                <label class="control-label col-sm-2 requiredField" for="endtime">
                                                    End Time
                                                    <span class="asteriskField">*</span>
                                                </label>
                                                <div class="col-sm-10">
                                                    <div class="input-group clockpicker" data-align="top" data-autoclose="true">
                                                        <div class="input-group-addon">
                                                            <i class="fa fa-clock-o"></i>
                                                        </div>
                                                        <input class="form-control" id="endtime" name="endtime" type="text" required />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group form-group-lg">
                                                <label class="control-label col-sm-2 requiredField" for="bookavail">
                                                    Availability
                                                    <span class="asteriskField">*</span>
                                                </label>
                                                <div class="col-sm-10">
                                                    <select class="select form-control" id="bookavail" name="bookavail" required>
                                                        <option value="available">available</option>
                                                        <option value="notavail">notavail</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-10 col-sm-offset-2">
                                                    <button class="btn btn-primary" type="submit">Submit</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                    <script>
                                        document.addEventListener('DOMContentLoaded', function() {
                                            $('.clockpicker').clockpicker();

                                            document.getElementById('schedule-form').addEventListener('submit', function(event) {
                                                event.preventDefault();

                                                const doctorId = getDoctorIdFromSession();

                                                const formData = new FormData(event.target);
                                                const data = {
                                                    scheduleDay: formData.get('date'),
                                                    startTime: formData.get('starttime'),
                                                    endTime: formData.get('endtime'),
                                                    isAvailable: formData.get('bookavail') === 'available'
                                                };


                                                fetch(`http://localhost:8080/${doctorId}/schedule/add-schedule`, {
                                                    method: 'POST',
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                    },
                                                    body: JSON.stringify(data),
                                                })
                                                    .then(response => {
                                                        if (!response.ok) {
                                                            throw new Error('Network response was not ok');
                                                        }
                                                        return response.json();
                                                    })
                                                    .then(data => {
                                                        console.log('Success:', data);
                                                        alert('Schedule added successfully!');
                                                    })
                                                    .catch(error => {
                                                        console.error('Error:', error);
                                                        alert('There was a problem with adding the schedule. Please try again.');
                                                    });
                                            });
                                        });
                                    </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- panel content end -->
                        <!-- panel end -->
                    </div>
                </div>
                <!-- panel start -->

                <!-- panel start -->
                <div class="panel panel-primary filterable">

                    <!-- panel heading starat -->
                    <div class="panel-heading">
                        <h3 class="panel-title">List of Patients</h3>
                        <div class="pull-right">
                            <button class="btn btn-default btn-xs btn-filter"><span class="fa fa-filter"></span>
                                Filter</button>
                        </div>
                    </div>
                    <!-- panel heading end -->

                    <div class="panel-body">
                        <!-- panel content start -->
                        <!-- Table -->
                        <h2>Doctor Schedule</h2>
                        <table class="table table-hover table-bordered">
                            <thead>
                            <tr class="filters">
                                <th><input type="text" class="form-control" placeholder="scheduleId" disabled></th>
                                <th><input type="text" class="form-control" placeholder="scheduleDay" disabled></th>
                                <th><input type="text" class="form-control" placeholder="startTime" disabled></th>
                                <th><input type="text" class="form-control" placeholder="endTime" disabled></th>
                                <th><input type="text" class="form-control" placeholder="bookAvail" disabled></th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody id="schedule-body">
                            <!-- Schedule rows will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                        <div class="panel panel-default">
                            <div class="col-md-offset-3 pull-right">
                                <button class="btn btn-primary" id="update-btn" type="submit">Update</button>
                            </div>
                        </div>
                    </div>

                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const doctorId = getDoctorIdFromSession(); // Implement this function to get the logged-in doctor's ID

                            // Fetch existing doctor schedule
                            fetch(`http://localhost:8080/${doctorId}/schedule/get-all`)
                                .then(response => response.json())
                                .then(schedules => {
                                    const scheduleBody = document.getElementById('schedule-body');
                                    schedules.forEach(schedule => {
                                        const row = document.createElement('tr');
                                        row.innerHTML = `
                                            <td>${schedule.id}</td>
                                            <td>${schedule.scheduleDay}</td>
                                            <td>${schedule.startTime}</td>
                                            <td>${schedule.endTime}</td>
                                            <td>${schedule.isAvailable}</td>
                                            <td class="text-center">
                                                <a href="#" id="${schedule.id}" class="delete"><span class="fas fa-trash" aria-hidden="true"></span></a>
                                            </td>
                                        `;
                                        scheduleBody.appendChild(row);
                                    });
                                })
                                .catch(error => console.error('Error fetching doctor schedule:', error));
                        });

                        document.getElementById('schedule-body').addEventListener('click', function(event) {
                            if (event.target.classList.contains('delete') || event.target.closest('.delete')) {
                                event.preventDefault();
                                const scheduleId = event.target.closest('a').id;
                                const doctorId = getDoctorIdFromSession();

                                if (confirm("Are you sure you want to delete this?")) {
                                    // Implement delete functionality here
                                    fetch(`http://localhost:8080/${doctorId}/schedule/delete/${scheduleId}`, {
                                        method: 'DELETE'
                                    })
                                        .then(response => {
                                            if (response.ok) {
                                                // Remove the row from the table
                                                const row = event.target.closest('tr');
                                                row.remove();
                                            } else {
                                                throw new Error('Failed to delete schedule');
                                            }
                                        })
                                        .catch(error => console.error('Error deleting schedule:', error));
                                }
                            }
                        });

                        function getDoctorIdFromSession() {
                            return sessionStorage.getItem('doctorId');
                        }
                    </script>


                    <!-- panel content end -->
                            <!-- panel end -->
                    </div>
                </div>
                <!-- panel start -->
            </div>
        </div>
        <!-- /#wrapper -->



        <!-- jQuery -->
        <script src="../patient/assets/js/jquery.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="../patient/assets/js/bootstrap.min.js"></script>
        <script src="assets/js/bootstrap-clockpicker.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <!-- script for jquery datatable start-->
        <!-- Include Date Range Picker -->
        <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js">
        </script>
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />

        <script>
        $(document).ready(function() {
            var date_input = $('input[name="date"]'); //our date input has the name "date"
            var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
            date_input.datepicker({
                format: 'yyyy/mm/dd',
                container: container,
                todayHighlight: true,
                autoclose: true,
            })
        })
        </script>
        <script type="text/javascript">
        $('.clockpicker').clockpicker();
        </script>
        <script type="text/javascript">

        $(document).ready(function() {
            $('.filterable .btn-filter').click(function() {
                var $panel = $(this).parents('.filterable'),
                    $filters = $panel.find('.filters input'),
                    $tbody = $panel.find('.table tbody');
                if ($filters.prop('disabled') == true) {
                    $filters.prop('disabled', false);
                    $filters.first().focus();
                } else {
                    $filters.val('').prop('disabled', true);
                    $tbody.find('.no-result').remove();
                    $tbody.find('tr').show();
                }
            });

            $('.filterable .filters input').keyup(function(e) {
                /* Ignore tab key */
                var code = e.keyCode || e.which;
                if (code == '9') return;
                /* Useful DOM data and selectors */
                var $input = $(this),
                    inputContent = $input.val().toLowerCase(),
                    $panel = $input.parents('.filterable'),
                    column = $panel.find('.filters th').index($input.parents('th')),
                    $table = $panel.find('.table'),
                    $rows = $table.find('tbody tr');
                /* Dirtiest filter function ever ;) */
                var $filteredRows = $rows.filter(function() {
                    var value = $(this).find('td').eq(column).text().toLowerCase();
                    return value.indexOf(inputContent) === -1;
                });
                /* Clean previous no-result if exist */
                $table.find('tbody .no-result').remove();
                /* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
                $rows.show();
                $filteredRows.hide();
                /* Prepend no-result row if all rows are filtered */
                if ($filteredRows.length === $rows.length) {
                    $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="' +
                        $table.find('.filters th').length + '">No result found</td></tr>'));
                }
            });
        });
        </script>

</body>

</html>

<script>
    $(document).ready(function() {
        const id = getPatientIdFromSession();

        console.log(id, 'id')
        if (id) {
            $.ajax({
                url: `http://localhost:8080/doctor/getDoctor/${id}`,
                type: 'GET',
                success: function(doctor) {
                    document.getElementById('fullName').innerText = doctor.firstName + " " + doctor.lastName;
                    document.getElementById('fullName2').innerText = doctor.firstName + " " + doctor.lastName;
                },
                error: function(err) {
                    console.error('Error fetching patient data:', err);
                }
            });
        } else {
            document.getElementById('user-first-name').innerText = "Error happened";
        }
    });

    function getPatientIdFromSession() {
        return sessionStorage.getItem('doctorId');
    }
</script>